<script>
"use strict";

/* =============================
   CANVAS SETUP
============================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* =============================
   KEEP CANVAS FOCUSED
============================= */
canvas.setAttribute("tabindex", "0");
canvas.focus();

/* =============================
   PLAYER
============================= */
const player = {
    x: 200,
    y: 200,
    width: 50,
    height: 80,
    vx: 0,
    vy: 0,
    speed: 5,
    jump: 14,
    onGround: false
};

/* =============================
   LOAD YOUR STICKMAN IMAGE
   (Put your image in same folder or change path)
============================= */
const stickImg = new Image();
stickImg.src = "stickman.png"; // <-- change if needed

/* =============================
   KEY SYSTEM (WASD)
============================= */
const keys = { w:false, a:false, s:false, d:false };

window.addEventListener("keydown", e => {
    const k = e.key.toLowerCase();
    if (k in keys) {
        keys[k] = true;
        e.preventDefault();
    }
});

window.addEventListener("keyup", e => {
    const k = e.key.toLowerCase();
    if (k in keys) {
        keys[k] = false;
        e.preventDefault();
    }
});

/* =============================
   WORLD / GROUND
============================= */
const gravity = 0.7;
const groundHeight = 120;

/* =============================
   UPDATE
============================= */
function update() {

    /* Horizontal movement */
    if (keys.a) player.vx = -player.speed;
    else if (keys.d) player.vx = player.speed;
    else player.vx = 0;

    /* Jump */
    if (keys.w && player.onGround) {
        player.vy = -player.jump;
        player.onGround = false;
    }

    /* Gravity */
    player.vy += gravity;

    /* Apply movement */
    player.x += player.vx;
    player.y += player.vy;

    /* Ground collision */
    const groundY = canvas.height - groundHeight;

    if (player.y + player.height > groundY) {
        player.y = groundY - player.height;
        player.vy = 0;
        player.onGround = true;
    }

    /* Keep on screen horizontally */
    if (player.x < 0) player.x = 0;
    if (player.x + player.width > canvas.width)
        player.x = canvas.width - player.width;
}

/* =============================
   DRAW WORLD
============================= */
function drawBackground() {

    /* Sky */
    ctx.fillStyle = "#87CEEB";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    /* Simple mountains */
    ctx.fillStyle = "#6b7a8f";
    for (let i = 0; i < canvas.width; i += 300) {
        ctx.beginPath();
        ctx.moveTo(i, canvas.height - groundHeight);
        ctx.lineTo(i + 150, canvas.height - groundHeight - 200);
        ctx.lineTo(i + 300, canvas.height - groundHeight);
        ctx.fill();
    }

    /* Ground */
    ctx.fillStyle = "#2e7d32";
    ctx.fillRect(0, canvas.height - groundHeight, canvas.width, groundHeight);
}

/* =============================
   DRAW PLAYER
============================= */
function drawPlayer() {

    if (stickImg.complete) {
        ctx.drawImage(
            stickImg,
            player.x,
            player.y,
            player.width,
            player.height
        );
    } else {
        /* fallback rectangle if image not loaded */
        ctx.fillStyle = "red";
        ctx.fillRect(player.x, player.y, player.width, player.height);
    }
}

/* =============================
   MAIN DRAW
============================= */
function draw() {
    drawBackground();
    drawPlayer();
}

/* =============================
   GAME LOOP
============================= */
function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

requestAnimationFrame(gameLoop);

/* =============================
   FIX TAB â†’ BLUE SCREEN BUG
============================= */
document.addEventListener("visibilitychange", () => {
    if (!document.hidden) {
        canvas.focus();
        requestAnimationFrame(gameLoop);
    }
});

</script>
