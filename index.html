<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Stickman Flat World</title>

<style>
body{
    margin:0;
    overflow:hidden;
    background:black;
}
canvas{
    display:block;
}
</style>
</head>

<body>
<canvas id="game"></canvas>

<script>
"use strict";

/* ======================
CANVAS
====================== */

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* ======================
IMAGE SETTINGS (CHANGE FILE NAMES HERE)
====================== */

const stickImg = new Image();
stickImg.src = "stickman.png";

const grassImg = new Image();
grassImg.src = "grass.png";

const treeImg = new Image();
treeImg.src = "tree.png";

const skyImg = new Image();
skyImg.src = "sky.png";

const rockImg = new Image();
rockImg.src = "rock.png";

/* ======================
IMAGE READY CHECK
====================== */

let imageReady = false;
stickImg.onload = ()=>{
    imageReady = true;
};

/* ======================
INPUT
====================== */

const keys = {};
window.addEventListener("keydown", e=>{
    keys[e.key.toLowerCase()] = true;
});
window.addEventListener("keyup", e=>{
    keys[e.key.toLowerCase()] = false;
});

/* ======================
WORLD
====================== */

const world = {
    gravity: 0.7,
    groundLevel: () => canvas.height * 0.78
};

/* ======================
PLAYER
====================== */

const player = {
    x: 200,
    y: 0,
    vx: 0,
    vy: 0,

    height: 200,
    width: 80,

    speed: 1.2,
    maxSpeed: 12,
    friction: 0.85,
    jump: 18,
    onGround: false
};

/* ======================
CAMERA
====================== */

const camera = {
    x: 0,
    smooth: 0.08
};

/* ======================
WORLD OBJECTS
====================== */

const trees = [];
const rocks = [];

/* TREE SPAWN (RANDOM SPACING) */
let treeX = 0;
for(let i=0;i<200;i++){
    treeX += 200 + Math.random()*400;
    trees.push({
        x: treeX,
        size: 0.7 + Math.random()*1.2
    });
}

/* ROCK SPAWN */
for(let i=0;i<40;i++){
    rocks.push({
        x: i*900 + 600 + Math.random()*300,
        size: 30 + Math.random()*30
    });
}

/* ======================
GROUND HEIGHT (FLAT)
====================== */

function groundHeightAt(){
    return world.groundLevel();
}

/* ======================
UPDATE
====================== */

function update(){

    /* MOVEMENT */
    if(keys["a"]) player.vx -= player.speed;
    if(keys["d"]) player.vx += player.speed;

    if((keys["w"] || keys[" "]) && player.onGround){
        player.vy = -player.jump;
        player.onGround = false;
    }

    player.vx = Math.max(-player.maxSpeed, Math.min(player.maxSpeed, player.vx));
    player.vx *= player.friction;

    player.vy += world.gravity;

    player.x += player.vx;
    player.y += player.vy;

    /* GROUND COLLISION */
    const ground = groundHeightAt();

    if(player.y + player.height > ground){
        player.y = ground - player.height;
        player.vy = 0;
        player.onGround = true;
    }

    /* ROCK COLLISION */
    rocks.forEach(r=>{
        if(Math.abs(player.x - r.x) < 50){

            let rockTop = ground - r.size;

            if(player.y + player.height > rockTop &&
               player.y + player.height < rockTop + 40){

                player.y = rockTop - player.height;
                player.vy = 0;
                player.onGround = true;
            }
        }
    });

    /* CAMERA FOLLOW */
    let target = player.x - canvas.width * 0.4;
    camera.x += (target - camera.x) * camera.smooth;
}

/* ======================
DRAW SKY (PNG)
====================== */

function drawSky(){

    if(skyImg.complete){
        ctx.drawImage(
            skyImg,
            0,
            0,
            canvas.width,
            canvas.height
        );
    }else{
        ctx.fillStyle = "#87c9ff";
        ctx.fillRect(0,0,canvas.width,canvas.height);
    }
}

/* ======================
DRAW GROUND (PNG TILE)
====================== */

function drawGround(){

    let ground = groundHeightAt();

    for(let x=-64; x<canvas.width+64; x+=64){

        ctx.drawImage(
            grassImg,
            x,
            ground - 64,
            64,
            64
        );
    }
}

/* ======================
DRAW TREES (PNG)
====================== */

function drawTrees(){

    trees.forEach(t=>{

        let screenX = t.x - camera.x;
        if(screenX < -200 || screenX > canvas.width+200) return;

        let ground = groundHeightAt();
        let size = 200 * t.size;

        ctx.drawImage(
            treeImg,
            screenX - size/2,
            ground - size,
            size,
            size
        );
    });
}

/* ======================
DRAW ROCKS
====================== */

function drawRocks(){

    rocks.forEach(r=>{

        let screenX = r.x - camera.x;
        let ground = groundHeightAt();

        if(rockImg.complete){
            ctx.drawImage(
                rockImg,
                screenX - r.size,
                ground - r.size*2,
                r.size*2,
                r.size*2
            );
        }else{
            ctx.fillStyle="#777";
            ctx.beginPath();
            ctx.arc(screenX, ground-r.size, r.size, 0, Math.PI*2);
            ctx.fill();
        }
    });
}

/* ======================
DRAW PLAYER (NO STRETCH)
====================== */

function drawPlayer(){

    let screenX = player.x - camera.x;

    if(imageReady){

        const ratio = stickImg.width / stickImg.height;

        const drawHeight = player.height;
        const drawWidth = drawHeight * ratio;

        ctx.drawImage(
            stickImg,
            screenX - drawWidth/2,
            player.y,
            drawWidth,
            drawHeight
        );

    }else{
        ctx.fillStyle="black";
        ctx.fillRect(screenX-20, player.y, 40, player.height);
    }
}

/* ======================
MAIN LOOP
====================== */

function loop(){

    update();

    drawSky();
    drawTrees();
    drawGround();
    drawRocks();
    drawPlayer();

    requestAnimationFrame(loop);
}

/* ======================
START
====================== */

player.y = groundHeightAt() - player.height;
loop();

</script>
</body>
</html>
